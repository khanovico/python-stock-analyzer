<!DOCTYPE html>
<html lang="en-US" class="gr__chartjs_org"><head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=Edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>App</title>
	<link rel="stylesheet" type="text/css" href="static/css/style.css">
	<script type="text/javascript" src="//code.jquery.com/jquery-1.9.1.js"></script>
	<script type="text/javascript" src="//code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
	<link rel="stylesheet" type="text/css" href="//code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css">
	<!-- Resources -->
	<script src="https://www.amcharts.com/lib/4/core.js"></script>
	<script src="https://www.amcharts.com/lib/4/charts.js"></script>
	<script src="https://www.amcharts.com/lib/4/themes/dark.js"></script>
	<script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>
	<!-- Styles -->
	<style>
		body { background-color: #30303d; color: #fff; }
		#chartdiv {
		  width: 100%;
		  height: 500px;
		}
	</style>
	<!-- Chart code -->
		<script>
		am4core.ready(function() {

		// Themes begin
		am4core.useTheme(am4themes_dark);
		am4core.useTheme(am4themes_animated);
		// Themes end

		var chart = am4core.create("chartdiv", am4charts.XYChart);

		var data = [];
		let dates = {{ stock_date|tojson|safe }};
		let closes = {{ stock_data|tojson|safe }};
		let mavg = {{ mav|tojson|safe }};
		let rets = {{rets|tojson|safe}}
		// console.log(json.length)


		for(let i = 0; i < dates.length; i++){
		  let date = dates[i];
		  let value = closes[i];
		  let mav = mavg[i];
		  let retrns = rets[i];
		  data.push({date:date,value:value, mav:mav, rets:retrns});
		}

		console.log(data)
		chart.data = data;

		// Create axes
		var dateAxis = chart.xAxes.push(new am4charts.DateAxis());
		dateAxis.renderer.minGridDistance = 60;

		var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());

		// Create series
		var series = chart.series.push(new am4charts.LineSeries());
		series.stroke = am4core.color("#ff0000");
		series.legendSettings.labelText = "[bold][red]Adj Close[/]";
		series.dataFields.valueY = "value";
		series.dataFields.dateX = "date";
		series.tooltipText = "{value}"

		var series1 = chart.series.push(new am4charts.LineSeries());
		series1.legendSettings.labelText = "Moving Average";
		series1.dataFields.valueY = "mav";
		series1.dataFields.dateX = "date";
		series1.tooltipText = "{value}"

		var series2 = chart.series.push(new am4charts.LineSeries());
		series2.legendSettings.labelText = "returns";
		series2.dataFields.valueY = "rets";
		series2.dataFields.dateX = "date";
		series2.tooltipText = "{value}"

		series.tooltip.pointerOrientation = "vertical";

		chart.cursor = new am4charts.XYCursor();
		chart.cursor.snapToSeries = series;
		chart.cursor.xAxis = dateAxis;

		chart.legend = new am4charts.Legend();
		var marker = chart.legend.markers.template.children.getIndex(0);
		marker.cornerRadius(12, 12, 12, 12);
		marker.strokeWidth = 2;
		marker.strokeOpacity = 1;
		marker.stroke = am4core.color("#ccc");

		//chart.scrollbarY = new am4core.Scrollbar();
		chart.scrollbarX = new am4core.Scrollbar();

		}); // end am4core.ready()
		</script>
</head>
<body data-gr-c-s-loaded="true">
	<style type="text/css">
		.container {
			  position: relative;
			  display: flex;
			  justify-content: center;
			}

			.container2 {
			  position: relative;
			  display: flex;
			  /*margin-top: 10px;*/
			  justify-content: center;
			}

			.centered-element {
			  height: 100px;
			  width: 100px;
			  position: absolute;
			  padding-top: 20px;
			  left: 8%;
			  right: 8%;
			  top: 100%;
			  margin-top: -50px;
			}
	</style>
	<div class="container">
		<form method="POST" action="/data" role="form" id="form">
			<div class="form-group">
				<label class="sr-only">Enter Stock Symbol</label>
				<input type="text" name="search" placeholder="Eg. aapl" />
				<select name="sourcery">
				  <option value="yahoo">Yahoo Finance</option>
				</select>
				<script type="text/javascript">
					$(window).load(function(){
						if ( $('#start')[0].type != 'date' ) $('#start').datepicker();
						if ( $('#end')[0].type != 'date' ) $('#end').datepicker();
					});
				</script>
					<label for="start">Start date:</label>
					<input type="date" id="start" name="trip-start"
					       value="{{start}}"
					       min="1970-01-01" max="2019-12-31" required>
					<label for="end">End date:</label>
					<input type="date" id="end" name="trip-end"
					       value="{{end}}"
					       min="1970-01-01" max="2019-12-31" required>
				<input type="submit" value="Submit">
			</div>
			</div>
		</form>
	</div>
		</div>
	</div>
	<div class="container2">
	<h1>{{company}} Stocks Price with The Moving Average (mavg)</h1>
	<div><br></div>
	<div class="centered-element" id="chartdiv" style="width:85%; height:400px;"></div>
	</div>
	</body>
</html>